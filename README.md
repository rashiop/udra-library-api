# udra-library-api

---
### What
Library API to facilitate book borrowing system.

---
### Tables
##### 1. User
There are 3 types of logged-in users: SUPERADMIN, ADMIN, MEMBER.
| _id (ObjectId, Autogenerate)  | email            | password (hashed) | firstname | lastname | gender (0=male, 1=female) | settings | role          | is_active |
| :---  | :---------------:| :------:  | :------:  | :------: | :----: | :------: | :--:          | :------: |
| 1  | admin@lib.ac     | admin     | Admin     | LastA | 0    | { theme, notification, compactMode } | admin         | true     |
| 2  | super@lib.ac     | admin     | Super     | LastS | 1  | { theme, notification, compactMode } | super_admin    | true     |
| 3  | member@gmail.com | member    | Member    | LastM | 0    | { theme, notification, compactMode } | user        | true     |

##### 2. Genre
| _id | name          | created_by| created_at | updated_by   | updated_at |
| ----| -------------:|:---------:| ----------:|:------------:| ----------:|
| 1   | Fiction       | _userid   | 2020-01-31 | _userid      | 2020-01-31 |
| 2   | Action        | _userid   | 2020-01-31 | _userid      | 2020-01-31 |

##### 3. Author

| _id | name          | created_by| created_at| updated_by    | updated_at |
| ----| --------------|:---------:| ----------:|:------------:| ----------:|
| 1   | Samudra       | _userid   | 2020-01-31 | _userid      | 2020-01-31 |
| 2   | WhiteyBravery | _userid   | 2020-01-31 | _userid      | 2020-01-31 |
| 3   | Bob C Martin  | _userid   | 2020-01-31 | _userid      | 2020-01-31 |

##### 4. Publisher
| _id | name          | created_by| created_at | updated_by   | updated_at |
| ----| --------------|:---------:| ----------:|:------------:| ----------:|
| 1   | Whiley        | _userid   | 2020-01-31 | _userid      | 2020-01-31 |
| 2   | Penerbit Pureo| _userid   | 2020-01-31 | _userid      | 2020-01-31 |

##### 5. Book

| _id | Title          | created_by| created_at | updated_by   | updated_at | author    | genres     | pubsliher | year | edition | total | stock |
| ----| ---------------|:---------:| ----------:|:------------:| ----------:| ---------:| ----------:| ---------:| ----------:| ----------:| ----------:|-------:|
| 1   | Clean Code     | _userid   | 2020-01-31 | _userid      | 2020-01-31 | _authorid | _genreid[] | _publisherid | 2020 | 10 | 1 | 0 |
| 2   | Penerbit Pureo | _userid   | 2020-01-31 | _userid      | 2020-01-31 | _authorid | _genreid[] | _publisherid | 2020 | 10 | 200 | 19 |

##### 6. BookTransaction (borrowed)
| _id | _bookid  | _userid | created_date | end_date  |
| --- | --------:| -------:|-------------:|----------:|
| 1   | _bookid  | _userid | 2020-01-31   | 2020-10-31|
| 2   | _bookid  | _userid | 2020-01-31   | 2020-10-31|
##### 7. BookRanking, generated by cron, cached
|  category | _books    |
| -------   | ---------:|
| weekly    | _booksid[]|
| monthly   | _booksid[]|
| yearly    | _booksid[]|
##### 8. Latest Book, cached
|  category | _books    |
| -------   | ---------:|
| _genreid  | _booksid[]|
#### Access Rights
##### 1. User
| Tables          | Create | Read  | Update | Delete  |
| ----------------|:------:| -----:|:------:| -------:|
| User            | v      | self  | self   | x       |
| Genre           | x      | v     | x      | x       |
| Author          | x      | v     | x      | x       |
| Book            | x      | v     | x      | x       |
| BookTransaction | v      | v     | v      | x       |
| BookRanking     | x      | v     | x      | x       |
| BookLatest      | x      | v     | x      | x       |
##### 2. Admin
| Tables          | Create | Read  | Update | Delete  |
| ----------------|:------:| -----:|:------:| -------:|
| User            | v      | v     | v      | x       |
| Genre           | v      | v     | v      | v       |
| Author          | v      | v     | v      | v       |
| Book            | v      | v     | v      | v       |
| BookTransaction | v      | v     | v      | x       |
| BookRanking     | x      | v     | x      | x       |
| BookLatest      | x      | v     | x      | x       |

##### 3. Super Admin
| Tables          | Create | Read  | Update | Delete  |
| ----------------|:------:| -----:|:------:| -------:|
| User            | v      | v     | v      | v       |
| Genre           | v      | v     | v      | v       |
| Author          | v      | v     | v      | v       |
| Book            | v      | v     | v      | v       |
| BookTransaction | v      | v     | v      | v       |
| BookRanking     | v      | v     | v      | v       |
| BookLatest      | v      | v     | v      | v       |


### Pre-requisite
---
1. Node
2. Yarn
### Running
1. installing depedencies
```
yarn
```
2. make 3 env
- .env.development
- .env.staging
- .env.development
```
APP_name=development udra library
PORT=3000
SALT_ROUND=10
DB_name=<<your db name>>
DB_PASSWORD=<<your db password name>>
```
3. start development
```
yarn dev
```

### Todo:
- [x] Error
- [x] Logging
- [x] Authorization
- [x] Authentication
- [ ] Cron
- [ ] Cache
- [ ] Socket
- [ ] Message broker
- [ ] Testing

